<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RuBlocks - –†—É—Å—Å–∫–∏–π Roblox —Å —Ä–µ–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π">
    <meta name="keywords" content="rublocks, roblox, –∏–≥—Ä—ã, –æ–Ω–ª–∞–π–Ω –∏–≥—Ä—ã, –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∏–≥—Ä—ã">
    <meta name="author" content="tolikpro128">
    <title>RuBlocks - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-container {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .auth-footer p {
            color: white;
            font-size: 13px;
            margin: 5px 0;
        }

        .auth-footer a {
            color: #ffd700;
            text-decoration: none;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è */
        .password-strength-indicator {
            height: 5px;
            background: #e0e0e0;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: all 0.3s;
        }

        .password-strength-weak {
            width: 33%;
            background: #e74c3c;
        }

        .password-strength-medium {
            width: 66%;
            background: #f39c12;
        }

        .password-strength-strong {
            width: 100%;
            background: #27ae60;
        }

        .password-strength-text {
            font-size: 11px;
            margin-top: 5px;
            color: #666;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–æ–ø–∫–∏ */
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        /* –ß–µ–∫–±–æ–∫—Å –∑–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è */
        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .remember-me input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .remember-me label {
            font-size: 14px;
            color: #666;
            cursor: pointer;
            user-select: none;
        }

        /* –°—Å—ã–ª–∫–∞ "–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?" */
        .forgot-password {
            text-align: right;
            margin-top: -10px;
            margin-bottom: 15px;
        }

        .forgot-password a {
            font-size: 13px;
            color: #667eea;
            text-decoration: none;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-box">
            <!-- –õ–æ–≥–æ—Ç–∏–ø –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <h1>üéÆ RuBlocks</h1>
            <p class="subtitle">–†—É—Å—Å–∫–∏–π Roblox - –ò–≥—Ä–∞–π, —Å–æ–∑–¥–∞–≤–∞–π, –æ–±—â–∞–π—Å—è!</p>
            
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ -->
            <div id="auth-tabs">
                <button class="tab-btn active" data-tab="login">–í—Ö–æ–¥</button>
                <button class="tab-btn" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <!-- ==========================================
                 –§–û–†–ú–ê –í–•–û–î–ê
                 ========================================== -->
            <form id="login-form" class="auth-form">
                <h2>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
                
                <div class="input-group">
                    <label>üìß Email</label>
                    <input 
                        type="email" 
                        id="login-email" 
                        required 
                        placeholder="your@email.com"
                        autocomplete="email"
                        autofocus>
                </div>
                
                <div class="input-group">
                    <label>üîí –ü–∞—Ä–æ–ª—å</label>
                    <input 
                        type="password" 
                        id="login-password" 
                        required 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                        autocomplete="current-password">
                </div>

                <div class="forgot-password">
                    <a href="#" onclick="forgotPassword(); return false;">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                </div>

                <div class="remember-me">
                    <input type="checkbox" id="remember-me" checked>
                    <label for="remember-me">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</label>
                </div>
                
                <button type="submit" class="btn-primary">
                    <span class="btn-text">–í–æ–π—Ç–∏</span>
                    <span class="btn-loader" style="display: none;">‚è≥</span>
                </button>
                
                <p class="error-message" id="login-error"></p>
            </form>

            <!-- ==========================================
                 –§–û–†–ú–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò
                 ========================================== -->
            <form id="register-form" class="auth-form" style="display: none;">
                <h2>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
                
                <div class="input-group">
                    <label>üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input 
                        type="text" 
                        id="register-username" 
                        required 
                        placeholder="–í–∞—à–µ –∏–º—è –≤ –∏–≥—Ä–µ" 
                        minlength="3"
                        maxlength="20"
                        pattern="[a-zA-Z–∞-—è–ê-–Ø0-9_]+"
                        title="–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _">
                    <small style="color: #999; font-size: 12px;">–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞, —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã</small>
                </div>
                
                <div class="input-group">
                    <label>üìß Email</label>
                    <input 
                        type="email" 
                        id="register-email" 
                        required 
                        placeholder="your@email.com"
                        autocomplete="email">
                </div>
                
                <div class="input-group">
                    <label>üîí –ü–∞—Ä–æ–ª—å</label>
                    <input 
                        type="password" 
                        id="register-password" 
                        required 
                        placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" 
                        minlength="6"
                        autocomplete="new-password">
                    <div class="password-strength-indicator">
                        <div class="password-strength-bar" id="password-strength-bar"></div>
                    </div>
                    <div class="password-strength-text" id="password-strength-text"></div>
                </div>
                
                <div class="input-group">
                    <label>üîí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                    <input 
                        type="password" 
                        id="register-password-confirm" 
                        required 
                        placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                        autocomplete="new-password">
                </div>

                <div class="remember-me">
                    <input type="checkbox" id="agree-terms" required>
                    <label for="agree-terms">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="#" style="color: #667eea;">–ø—Ä–∞–≤–∏–ª–∞–º–∏</a></label>
                </div>
                
                <button type="submit" class="btn-primary">
                    <span class="btn-text">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>
                    <span class="btn-loader" style="display: none;">‚è≥</span>
                </button>
                
                <p class="error-message" id="register-error"></p>
            </form>

            <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
            <div class="divider">–∏–ª–∏</div>

            <!-- –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google -->
            <button class="btn-google" id="google-login-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="20">
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
            </button>
        </div>

        <!-- –§—É—Ç–µ—Ä -->
        <div class="auth-footer">
            <p>üîí –ó–∞—â–∏—â–µ–Ω–æ Firebase Authentication</p>
            <p>¬© 2024 RuBlocks | –°–æ–∑–¥–∞–Ω–æ <a href="#">tolikpro128</a></p>
            <p style="font-size: 11px; margin-top: 10px;">
                <a href="#">–û –ø—Ä–æ–µ–∫—Ç–µ</a> ‚Ä¢ 
                <a href="#">–ü—Ä–∞–≤–∏–ª–∞</a> ‚Ä¢ 
                <a href="#">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
            </p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // ==========================================
        // Firebase Configuration
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyA76Du2jnVguJavcO7k6XFEQJ0tPhHF_UI",
            authDomain: "rublocks-2862b.firebaseapp.com",
            projectId: "rublocks-2862b",
            storageBucket: "rublocks-2862b.firebasestorage.app",
            messagingSenderId: "1035853997972",
            appId: "1:1035853997972:web:77cf13e7197b9387cd9181"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        console.log('‚úÖ Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

        // –í–∫–ª—é—á–∞–µ–º —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –æ—à–∏–±–æ–∫
        auth.languageCode = 'ru';

        // ==========================================
        // –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö
        // ==========================================
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tab = this.getAttribute('data-tab');
                
                // –£–±–∏—Ä–∞–µ–º active —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                
                // –î–æ–±–∞–≤–ª—è–µ–º active –∫ —Ç–µ–∫—É—â–µ–π
                this.classList.add('active');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–æ—Ä–º—É
                if (tab === 'login') {
                    document.getElementById('login-form').style.display = 'block';
                    document.getElementById('login-email').focus();
                } else {
                    document.getElementById('register-form').style.display = 'block';
                    document.getElementById('register-username').focus();
                }
                
                // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫–∏
                document.getElementById('login-error').textContent = '';
                document.getElementById('register-error').textContent = '';
                document.getElementById('login-error').style.display = 'none';
                document.getElementById('register-error').style.display = 'none';
            });
        });

        // ==========================================
        // –ü–†–û–í–ï–†–ö–ê –°–ò–õ–´ –ü–ê–†–û–õ–Ø
        // ==========================================
        document.getElementById('register-password').addEventListener('input', function() {
            const password = this.value;
            const strengthBar = document.getElementById('password-strength-bar');
            const strengthText = document.getElementById('password-strength-text');

            if (password.length === 0) {
                strengthBar.className = 'password-strength-bar';
                strengthText.textContent = '';
                return;
            }

            let strength = 0;
            
            // –î–ª–∏–Ω–∞
            if (password.length >= 6) strength++;
            if (password.length >= 10) strength++;
            
            // –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–∏–º–≤–æ–ª–æ–≤
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^a-zA-Z\d]/.test(password)) strength++;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å
            strengthBar.className = 'password-strength-bar';
            
            if (strength <= 2) {
                strengthBar.classList.add('password-strength-weak');
                strengthText.textContent = 'üî¥ –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å';
                strengthText.style.color = '#e74c3c';
            } else if (strength <= 4) {
                strengthBar.classList.add('password-strength-medium');
                strengthText.textContent = 'üü° –°—Ä–µ–¥–Ω–∏–π –ø–∞—Ä–æ–ª—å';
                strengthText.style.color = '#f39c12';
            } else {
                strengthBar.classList.add('password-strength-strong');
                strengthText.textContent = 'üü¢ –°–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                strengthText.style.color = '#27ae60';
            }
        });

        // ==========================================
        // –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
        // ==========================================
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', user.email);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ Firestore
                try {
                    const doc = await db.collection('users').doc(user.uid).get();
                    
                    if (!doc.exists) {
                        console.log('üìù –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è...');
                        // –°–æ–∑–¥–∞—ë–º –ø—Ä–æ—Ñ–∏–ª—å –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                        await db.collection('users').doc(user.uid).set({
                            username: user.displayName || user.email.split('@')[0],
                            email: user.email,
                            photoURL: user.photoURL,
                            stats: {
                                gamesPlayed: 0,
                                wins: 0,
                                highScore: 0,
                                totalPlayTime: 0,
                                level: 1,
                                coins: 100,
                                gems: 10
                            },
                            inventory: [],
                            friends: [],
                            achievements: [],
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                            isOnline: true
                        });
                    } else {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
                        await db.collection('users').doc(user.uid).update({
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                            isOnline: true
                        });
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º:', error);
                }
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –ª–æ–±–±–∏
                window.location.href = 'pages/lobby.html';
            } else {
                console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
            }
        });

        // ==========================================
        // –í–•–û–î
        // ==========================================
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            const errorEl = document.getElementById('login-error');
            const btn = e.target.querySelector('.btn-primary');
            const btnText = btn.querySelector('.btn-text');
            const btnLoader = btn.querySelector('.btn-loader');

            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btnText.style.display = 'none';
                btnLoader.style.display = 'inline';
                btn.disabled = true;
                errorEl.textContent = '';
                errorEl.style.display = 'none';

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
                if (rememberMe) {
                    await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                } else {
                    await auth.setPersistence(firebase.auth.Auth.Persistence.SESSION);
                }

                // –í—Ö–æ–¥–∏–º
                await auth.signInWithEmailAndPassword(email, password);
                console.log('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                errorEl.textContent = getErrorMessage(error.code);
                errorEl.style.display = 'block';
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btnText.style.display = 'inline';
                btnLoader.style.display = 'none';
                btn.disabled = false;
            }
        });

        // ==========================================
        // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        // ==========================================
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const passwordConfirm = document.getElementById('register-password-confirm').value;
            const errorEl = document.getElementById('register-error');
            const btn = e.target.querySelector('.btn-primary');
            const btnText = btn.querySelector('.btn-text');
            const btnLoader = btn.querySelector('.btn-loader');

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
            if (password !== passwordConfirm) {
                errorEl.textContent = '‚ùå –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!';
                errorEl.style.display = 'block';
                return;
            }

            if (username.length < 3) {
                errorEl.textContent = '‚ùå –ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞!';
                errorEl.style.display = 'block';
                return;
            }

            if (!/^[a-zA-Z–∞-—è–ê-–Ø0-9_]+$/.test(username)) {
                errorEl.textContent = '‚ùå –ò–º—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
                errorEl.style.display = 'block';
                return;
            }

            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btnText.style.display = 'none';
                btnLoader.style.display = 'inline';
                btn.disabled = true;
                errorEl.textContent = '';
                errorEl.style.display = 'none';

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const usernameQuery = await db.collection('users')
                    .where('username', '==', username)
                    .get();

                if (!usernameQuery.empty) {
                    throw new Error('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!');
                }

                // –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                await user.updateProfile({
                    displayName: username
                });

                // –°–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤ Firestore
                await db.collection('users').doc(user.uid).set({
                    username: username,
                    email: email,
                    photoURL: user.photoURL,
                    stats: {
                        gamesPlayed: 0,
                        wins: 0,
                        highScore: 0,
                        totalPlayTime: 0,
                        level: 1,
                        coins: 100, // –°—Ç–∞—Ä—Ç–æ–≤—ã–µ –º–æ–Ω–µ—Ç—ã
                        gems: 10    // –°—Ç–∞—Ä—Ç–æ–≤—ã–µ –≥–µ–º—ã
                    },
                    inventory: [],
                    friends: [],
                    achievements: [],
                    settings: {
                        notifications: true,
                        soundEnabled: true,
                        musicEnabled: true
                    },
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                    isOnline: true
                });

                console.log('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                errorEl.className = 'success-message';
                errorEl.textContent = '‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ª–æ–±–±–∏...';
                errorEl.style.display = 'block';

                // Firebase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç —á–µ—Ä–µ–∑ onAuthStateChanged

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                errorEl.className = 'error-message';
                errorEl.textContent = error.message || getErrorMessage(error.code);
                errorEl.style.display = 'block';
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                btnText.style.display = 'inline';
                btnLoader.style.display = 'none';
                btn.disabled = false;
            }
        });

        // ==========================================
        // –í–•–û–î –ß–ï–†–ï–ó GOOGLE
        // ==========================================
        document.getElementById('google-login-btn').addEventListener('click', async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.setCustomParameters({
                    prompt: 'select_account'
                });
                
                const result = await auth.signInWithPopup(provider);
                console.log('‚úÖ –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google –≤—ã–ø–æ–ª–Ω–µ–Ω:', result.user.email);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
                const doc = await db.collection('users').doc(result.user.uid).get();
                
                if (!doc.exists) {
                    // –°–æ–∑–¥–∞—ë–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Google
                    await db.collection('users').doc(result.user.uid).set({
                        username: result.user.displayName || result.user.email.split('@')[0],
                        email: result.user.email,
                        photoURL: result.user.photoURL,
                        stats: {
                            gamesPlayed: 0,
                            wins: 0,
                            highScore: 0,
                            totalPlayTime: 0,
                            level: 1,
                            coins: 100,
                            gems: 10
                        },
                        inventory: [],
                        friends: [],
                        achievements: [],
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                        isOnline: true
                    });
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google:', error);
                
                if (error.code !== 'auth/popup-closed-by-user') {
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google: ' + getErrorMessage(error.code));
                }
            }
        });

        // ==========================================
        // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ü–ê–†–û–õ–Ø
        // ==========================================
        async function forgotPassword() {
            const email = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è:');
            
            if (!email) return;

            try {
                await auth.sendPasswordResetEmail(email);
                alert('‚úÖ –ü–∏—Å—å–º–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ' + email);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è:', error);
                alert('–û—à–∏–±–∫–∞: ' + getErrorMessage(error.code));
            }
        }

        // ==========================================
        // –ü–ï–†–ï–í–û–î –û–®–ò–ë–û–ö
        // ==========================================
        function getErrorMessage(errorCode) {
            const errors = {
                'auth/email-already-in-use': '–≠—Ç–æ—Ç email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è',
                'auth/invalid-email': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email',
                'auth/weak-password': '–°–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)',
                'auth/user-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω',
                'auth/wrong-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                'auth/invalid-credential': '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å',
                'auth/too-many-requests': '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ',
                'auth/network-request-failed': '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É',
                'auth/user-disabled': '–≠—Ç–æ—Ç –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω',
                'auth/operation-not-allowed': '–û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞',
                'auth/popup-closed-by-user': '–û–∫–Ω–æ –≤—Ö–æ–¥–∞ –±—ã–ª–æ –∑–∞–∫—Ä—ã—Ç–æ',
                'auth/cancelled-popup-request': '–ó–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω—ë–Ω'
            };

            return errors[errorCode] || `–û—à–∏–±–∫–∞: ${errorCode}`;
        }

        // ==========================================
        // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ==========================================

        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            document.getElementById('login-email').focus();
        });

        // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.target.closest('form').querySelector('button[type="submit"]').click();
            }
        });

        console.log('‚úÖ –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
        console.log('üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:', /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? '–ú–æ–±–∏–ª—å–Ω–æ–µ' : '–ü–ö');
    </script>
</body>
</html>